<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripGenie - Your AI Travel Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Gemini AI Integration -->
    <script type="importmap">
        {
          "imports": {
            "@google/generative-ai": "https://esm.run/@google/generative-ai"
          }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-card { backdrop-filter: blur(16px); background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); }
        .animate-float { animation: float 6s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        .animate-pulse-slow { animation: pulse 3s infinite; }
        .day-card { transition: all 0.3s ease; transform: translateY(0); }
        .day-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .cost-bar { transition: width 1s ease-in-out; }
        .preference-selected { background: rgba(255, 255, 255, 0.2) !important; border: 1px solid #fde047 !important; }
        .loading-spinner { animation: spin 2s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .loading-dots::after {
            content: '';
            animation: dots 2s infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800">
    <!-- Enhanced Header -->
    <header class="relative overflow-hidden min-h-screen flex items-center">
        <div class="absolute inset-0 bg-black/30"></div>
        
        <div class="relative z-10 container mx-auto px-6 text-center">
            <div class="animate-float mb-8">
                <i class="fas fa-magic text-8xl text-yellow-300 mb-6"></i>
            </div>
            <h1 class="text-6xl md:text-8xl font-bold text-white mb-6 animate-pulse-slow">
                Trip<span class="text-yellow-300">Genie</span>
            </h1>
            <p class="text-2xl text-white/90 max-w-3xl mx-auto mb-8 leading-relaxed">
                Your AI-powered travel assistant that creates <span class="text-yellow-300 font-semibold">personalized itineraries</span> with smart budget planning in seconds âœ¨
            </p>
            
            <!-- Feature Highlights -->
            <div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto mb-12">
                <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-all duration-300">
                    <i class="fas fa-brain text-4xl text-yellow-300 mb-4"></i>
                    <h3 class="text-xl font-bold text-white mb-2">AI-Powered Planning</h3>
                    <p class="text-white/70">Smart algorithms create perfect itineraries based on your preferences</p>
                </div>
                <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-all duration-300">
                    <i class="fas fa-route text-4xl text-yellow-300 mb-4"></i>
                    <h3 class="text-xl font-bold text-white mb-2">Day-by-Day Schedules</h3>
                    <p class="text-white/70">Detailed morning, afternoon, and evening activity planning</p>
                </div>
                <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-all duration-300">
                    <i class="fas fa-calculator text-4xl text-yellow-300 mb-4"></i>
                    <h3 class="text-xl font-bold text-white mb-2">Smart Budget Allocation</h3>
                    <p class="text-white/70">Optimized spending across lodging, food, transport, and activities</p>
                </div>
            </div>
            
            <!-- CTA Button -->
            <div class="animate-bounce">
                <button onclick="document.getElementById('tripForm').scrollIntoView({behavior: 'smooth'})" 
                        class="bg-gradient-to-r from-yellow-400 to-orange-500 text-purple-900 font-bold py-4 px-12 rounded-full text-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-110 transition-all duration-300 shadow-2xl">
                    <i class="fas fa-rocket mr-3"></i>Start Planning Your Dream Trip
                </button>
            </div>
            
            <!-- Stats -->
            <div class="grid grid-cols-3 gap-8 max-w-2xl mx-auto mt-16">
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-300 mb-2">1000+</div>
                    <div class="text-white/70">Destinations</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-300 mb-2">AI-Powered</div>
                    <div class="text-white/70">Recommendations</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-300 mb-2">24/7</div>
                    <div class="text-white/70">Available</div>
                </div>
            </div>
        </div>
        
        <!-- Scroll indicator -->
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
            <i class="fas fa-chevron-down text-white/50 text-2xl"></i>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        <!-- Enhanced Input Form -->
        <div class="glass-card rounded-3xl p-8 mb-12 max-w-4xl mx-auto shadow-2xl">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-white mb-2">Plan Your Perfect Trip</h2>
                <p class="text-white/70">Fill in your details and let our AI create your dream itinerary</p>
            </div>
            
            <form id="tripForm" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-white font-semibold mb-2">
                            <i class="fas fa-map-marker-alt mr-2 text-yellow-300"></i>Destination
                        </label>
                        <input type="text" id="destination" required 
                               class="w-full p-4 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:border-yellow-300 focus:outline-none focus:ring-2 focus:ring-yellow-300/50 transition-all"
                               placeholder="e.g., Paris, Tokyo, New York">
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">
                            <i class="fas fa-calendar mr-2 text-yellow-300"></i>Duration (days)
                        </label>
                        <input type="number" id="days" min="1" max="30" required 
                               class="w-full p-4 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:border-yellow-300 focus:outline-none focus:ring-2 focus:ring-yellow-300/50 transition-all"
                               placeholder="3">
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-white font-semibold mb-2">
                            <i class="fas fa-dollar-sign mr-2 text-yellow-300"></i>Budget (total)
                        </label>
                        <input type="number" id="budget" min="100" required 
                               class="w-full p-4 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:border-yellow-300 focus:outline-none focus:ring-2 focus:ring-yellow-300/50 transition-all"
                               placeholder="1000">
                    </div>
                    <div>
                        <label class="block text-white font-semibold mb-2">
                            <i class="fas fa-users mr-2 text-yellow-300"></i>Travelers
                        </label>
                        <input type="number" id="travelers" min="1" max="20" required 
                               class="w-full p-4 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:border-yellow-300 focus:outline-none focus:ring-2 focus:ring-yellow-300/50 transition-all"
                               placeholder="2">
                    </div>
                </div>

                <div>
                    <label class="block text-white font-semibold mb-4">
                        <i class="fas fa-heart mr-2 text-yellow-300"></i>Travel Preferences
                    </label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Museums">
                            <i class="fas fa-museum text-yellow-300"></i>
                            <span class="text-white text-sm">Museums</span>
                        </div>
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Food">
                            <i class="fas fa-utensils text-yellow-300"></i>
                            <span class="text-white text-sm">Food</span>
                        </div>
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Adventure">
                            <i class="fas fa-mountain text-yellow-300"></i>
                            <span class="text-white text-sm">Adventure</span>
                        </div>
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Shopping">
                            <i class="fas fa-shopping-bag text-yellow-300"></i>
                            <span class="text-white text-sm">Shopping</span>
                        </div>
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Photography">
                            <i class="fas fa-camera text-yellow-300"></i>
                            <span class="text-white text-sm">Photography</span>
                        </div>
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Nightlife">
                            <i class="fas fa-music text-yellow-300"></i>
                            <span class="text-white text-sm">Nightlife</span>
                        </div>
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Nature">
                            <i class="fas fa-tree text-yellow-300"></i>
                            <span class="text-white text-sm">Nature</span>
                        </div>
                        <div class="preference-tag flex items-center space-x-2 p-3 rounded-xl bg-white/10 cursor-pointer hover:bg-white/20 transition-all" data-preference="Relaxation">
                            <i class="fas fa-spa text-yellow-300"></i>
                            <span class="text-white text-sm">Relaxation</span>
                        </div>
                    </div>
                </div>

                <button type="submit" id="generateBtn" 
                        class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-purple-900 font-bold py-4 px-8 rounded-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-200 shadow-lg">
                    <i class="fas fa-magic mr-2"></i>Generate My Dream Trip
                </button>
            </form>
        </div>

        <!-- Enhanced Loading Animation -->
        <div id="loadingSection" class="hidden text-center py-12">
            <div class="glass-card rounded-3xl p-12 max-w-2xl mx-auto">
                <!-- AI Robot Animation -->
                <div class="mb-8">
                    <div class="relative inline-block">
                        <div class="loading-spinner text-6xl text-yellow-300 mb-4">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="absolute -top-2 -right-2 animate-ping">
                            <i class="fas fa-brain text-purple-300 text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <h3 class="text-3xl font-bold text-white mb-4">ðŸ¤– AI Genie is Working<span class="loading-dots"></span></h3>
                <p class="text-xl text-white/80 mb-8" id="loadingMessage">Analyzing your dream destination...</p>
                
                <!-- Progress Bar -->
                <div class="bg-white/20 rounded-full h-3 mb-6 overflow-hidden">
                    <div id="progressBar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                
                <!-- AI Status -->
                <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-xl p-4 border border-purple-300/30">
                    <div class="flex items-center justify-center mb-2">
                        <i class="fas fa-cpu text-purple-300 mr-2 animate-pulse"></i>
                        <span class="text-purple-300 font-semibold">AI Status:</span>
                    </div>
                    <p class="text-white/80 text-sm italic" id="aiStatus">Initializing travel planning algorithms...</p>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <!-- Budget Overview -->
            <div class="glass-card rounded-3xl p-8 mb-8 shadow-2xl">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                    <i class="fas fa-chart-pie mr-3 text-yellow-300"></i>Smart Budget Breakdown
                </h2>
                <div class="grid md:grid-cols-4 gap-6" id="budgetBreakdown">
                    <!-- Budget items will be generated here -->
                </div>
            </div>

            <!-- Itinerary -->
            <div class="glass-card rounded-3xl p-8 mb-8 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white flex items-center">
                        <i class="fas fa-route mr-3 text-yellow-300"></i>Your Perfect Itinerary
                    </h2>
                    <div class="flex gap-3">
                        <button id="shareBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all shadow-lg hover:shadow-xl">
                            <i class="fas fa-share mr-2"></i>Share
                        </button>
                        <button id="downloadBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all shadow-lg hover:shadow-xl">
                            <i class="fas fa-download mr-2"></i>PDF
                        </button>
                    </div>
                </div>
                <div id="itineraryContainer">
                    <!-- Daily itinerary will be generated here -->
                </div>
            </div>

            <!-- Travel Tips -->
            <div class="glass-card rounded-3xl p-8 shadow-2xl">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                    <i class="fas fa-lightbulb mr-3 text-yellow-300"></i>Insider Travel Tips
                </h2>
                <div id="travelTips" class="grid md:grid-cols-2 gap-6">
                    <!-- Tips will be generated here -->
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";
        
        // Initialize Gemini AI
        const API_KEY = "AIzaSyAquefSZWF1b1Dx_m17MTwt78BvMgcIDXE";
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        
        // Global state
        let selectedPreferences = [];
        let currentItineraryData = null;
        
        // Enhanced loading messages and status
        const loadingMessages = [
            "Analyzing your destination...",
            "Finding the best activities...",
            "Calculating optimal budget...", 
            "Discovering restaurants and hotels...",
            "Creating your perfect itinerary...",
            "Adding final touches..."
        ];
        
        const aiStatusMessages = [
            "Processing destination data and travel patterns...",
            "Matching activities to your preferences...",
            "Optimizing costs and finding best value options...",
            "Curating local dining and accommodation...",
            "Finalizing your personalized travel plan...",
            "Almost ready! Putting everything together..."
        ];
        
        let messageInterval;
        let progressInterval;
        
        function startLoadingAnimation() {
            let messageIndex = 0;
            let progress = 0;
            
            // Update messages and status
            messageInterval = setInterval(() => {
                document.getElementById('loadingMessage').textContent = loadingMessages[messageIndex];
                document.getElementById('aiStatus').textContent = aiStatusMessages[messageIndex];
                messageIndex = (messageIndex + 1) % loadingMessages.length;
            }, 2500);
            
            // Update progress bar
            progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 95) progress = 95;
                document.getElementById('progressBar').style.width = progress + '%';
            }, 1000);
        }
        
        function stopLoadingAnimation() {
            if (messageInterval) clearInterval(messageInterval);
            if (progressInterval) clearInterval(progressInterval);
            
            // Complete progress bar
            document.getElementById('progressBar').style.width = '100%';
            document.getElementById('loadingMessage').textContent = "Complete! Your itinerary is ready! ðŸŽ‰";
            document.getElementById('aiStatus').textContent = "AI planning successful - enjoy your trip!";
        }
        
        // AI Functions
        async function generateAIItinerary(destination, days, budget, travelers, preferences) {
            const preferencesText = preferences.length > 0 ? preferences.join(', ') : 'general sightseeing';
            
            const prompt = `Create a ${days}-day travel itinerary for ${destination} with budget $${budget} for ${travelers} travelers. Preferences: ${preferencesText}

Return ONLY valid JSON in this format:
{
  "itinerary": [
    {
      "day": 1,
      "morning": {"activity": "Morning Activity", "description": "Description", "cost": 25, "location": "Location"},
      "afternoon": {"activity": "Afternoon Activity", "description": "Description", "cost": 30, "location": "Location"},
      "evening": {"activity": "Evening Activity", "description": "Description", "cost": 20, "location": "Location"},
      "restaurants": {
        "lunch": {"name": "Restaurant Name", "cuisine": "Cuisine Type", "cost": 35, "location": "Address", "description": "Description"},
        "dinner": {"name": "Restaurant Name", "cuisine": "Cuisine Type", "cost": 50, "location": "Address", "description": "Description"}
      },
      "hotel": {"name": "Hotel Name", "cost": 120, "location": "Address", "rating": "4.2", "description": "Description", "amenities": ["WiFi", "Breakfast"]}
    }
  ]
}`;

            try {
                const result = await model.generateContent(prompt);
                const text = result.response.text();
                console.log('AI Response:', text);
                
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
            } catch (error) {
                console.error('AI Error:', error);
            }
            
            // Fallback data
            return createFallbackItinerary(destination, days, budget);
        }

        async function generateAIBudget(destination, budget, days, travelers) {
            try {
                const result = await model.generateContent(`Create budget breakdown for ${days}-day trip to ${destination}, budget $${budget}. Return JSON: {"breakdown": {"lodging": {"amount": 400, "percentage": 40}, "food": {"amount": 300, "percentage": 30}, "transport": {"amount": 200, "percentage": 20}, "attractions": {"amount": 100, "percentage": 10}}}`);
                const text = result.response.text();
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
            } catch (error) {
                console.error('Budget Error:', error);
            }
            
            return {
                breakdown: {
                    lodging: {amount: Math.round(budget * 0.4), percentage: 40},
                    food: {amount: Math.round(budget * 0.3), percentage: 30},
                    transport: {amount: Math.round(budget * 0.2), percentage: 20},
                    attractions: {amount: Math.round(budget * 0.1), percentage: 10}
                }
            };
        }

        async function generateAITips(destination, preferences) {
            try {
                const result = await model.generateContent(`Generate 6 travel tips for ${destination}. Return JSON array: ["tip1", "tip2", "tip3", "tip4", "tip5", "tip6"]`);
                const text = result.response.text();
                const jsonMatch = text.match(/\[[\s\S]*\]/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
            } catch (error) {
                console.error('Tips Error:', error);
            }
            
            return [
                `Research local customs before visiting ${destination}`,
                "Download offline maps and translation apps",
                "Keep copies of documents in separate locations",
                "Learn key phrases in the local language",
                "Check visa requirements well in advance",
                "Pack appropriate clothing for local weather"
            ];
        }

        function createFallbackItinerary(destination, days, budget) {
            const itinerary = [];
            const dayBudget = Math.round(budget / days);
            
            for (let day = 1; day <= days; day++) {
                itinerary.push({
                    day: day,
                    morning: {
                        activity: `Morning in ${destination}`,
                        description: "Explore local attractions and landmarks",
                        cost: Math.round(dayBudget * 0.15),
                        location: `${destination} city center`
                    },
                    afternoon: {
                        activity: `Afternoon activities`,
                        description: "Cultural experiences and sightseeing",
                        cost: Math.round(dayBudget * 0.2),
                        location: `${destination} main district`
                    },
                    evening: {
                        activity: `Evening exploration`,
                        description: "Local nightlife and atmosphere",
                        cost: Math.round(dayBudget * 0.1),
                        location: `${destination} evening district`
                    },
                    restaurants: {
                        lunch: {
                            name: `${destination} Lunch Spot`,
                            cuisine: "Local",
                            cost: Math.round(dayBudget * 0.15),
                            location: `${destination} dining area`,
                            description: "Popular local lunch restaurant"
                        },
                        dinner: {
                            name: `${destination} Dinner`,
                            cuisine: "Traditional",
                            cost: Math.round(dayBudget * 0.25),
                            location: `${destination} restaurant district`,
                            description: "Authentic dinner experience"
                        }
                    },
                    hotel: day < days ? {
                        name: `${destination} Hotel`,
                        cost: Math.round(dayBudget * 0.4),
                        location: `${destination} hotel district`,
                        rating: "4.0",
                        description: "Comfortable accommodation",
                        amenities: ["WiFi", "Breakfast", "24h Reception"]
                    } : null
                });
            }
            
            return { itinerary };
        }
        
        // UI Functions
        function generateBudgetBreakdown(budgetData) {
            const budgetContainer = document.getElementById('budgetBreakdown');
            const categories = [
                { key: 'lodging', name: 'Lodging', icon: 'fas fa-bed', color: 'bg-blue-500' },
                { key: 'food', name: 'Food', icon: 'fas fa-utensils', color: 'bg-green-500' },
                { key: 'transport', name: 'Transport', icon: 'fas fa-car', color: 'bg-yellow-500' },
                { key: 'attractions', name: 'Attractions', icon: 'fas fa-ticket-alt', color: 'bg-purple-500' }
            ];

            budgetContainer.innerHTML = categories.map(cat => {
                const data = budgetData.breakdown[cat.key];
                return `
                    <div class="text-center">
                        <div class="mb-4">
                            <i class="${cat.icon} text-3xl text-white mb-2"></i>
                            <h4 class="text-white font-semibold">${cat.name}</h4>
                        </div>
                        <div class="bg-white/20 rounded-full h-3 mb-2">
                            <div class="${cat.color} h-3 rounded-full cost-bar" style="width: ${data.percentage}%"></div>
                        </div>
                        <p class="text-white font-bold text-lg">$${data.amount}</p>
                        <p class="text-white/70 text-sm">${data.percentage}% of budget</p>
                    </div>
                `;
            }).join('');
        }

        function generateDailyItinerary(itineraryData) {
            const itineraryContainer = document.getElementById('itineraryContainer');
            currentItineraryData = itineraryData;
            
            itineraryContainer.innerHTML = itineraryData.itinerary.map(dayData => {
                const activityCost = (dayData.morning?.cost || 0) + (dayData.afternoon?.cost || 0) + (dayData.evening?.cost || 0);
                const restaurantCost = (dayData.restaurants?.lunch?.cost || 0) + (dayData.restaurants?.dinner?.cost || 0);
                const hotelCost = dayData.hotel?.cost || 0;
                const totalCost = activityCost + restaurantCost + hotelCost;
                
                return `
                    <div class="day-card bg-white/10 rounded-2xl p-6 mb-8 hover:bg-white/15 transition-all shadow-lg">
                        <div class="flex items-center mb-6">
                            <div class="bg-gradient-to-r from-yellow-300 to-orange-400 text-purple-900 w-12 h-12 rounded-full flex items-center justify-center font-bold mr-4 text-lg shadow-lg">
                                ${dayData.day}
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-white">Day ${dayData.day}</h3>
                                <p class="text-yellow-300 font-medium">Complete daily plan</p>
                            </div>
                        </div>
                        
                        <!-- Activities -->
                        <div class="mb-6">
                            <h4 class="text-xl font-semibold text-white mb-4 flex items-center">
                                <i class="fas fa-map-marked-alt mr-2 text-yellow-300"></i>Activities
                            </h4>
                            <div class="grid md:grid-cols-3 gap-4">
                                ${generateActivityCard('Morning', dayData.morning, 'fas fa-sun')}
                                ${generateActivityCard('Afternoon', dayData.afternoon, 'fas fa-cloud-sun')}
                                ${generateActivityCard('Evening', dayData.evening, 'fas fa-moon')}
                            </div>
                        </div>
                        
                        <!-- Restaurants -->
                        <div class="mb-6">
                            <h4 class="text-xl font-semibold text-white mb-4 flex items-center">
                                <i class="fas fa-utensils mr-2 text-yellow-300"></i>Dining
                            </h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                ${generateRestaurantCard('Lunch', dayData.restaurants?.lunch)}
                                ${generateRestaurantCard('Dinner', dayData.restaurants?.dinner)}
                            </div>
                        </div>
                        
                        ${dayData.hotel ? `
                        <!-- Hotel -->
                        <div class="mb-6">
                            <h4 class="text-xl font-semibold text-white mb-4 flex items-center">
                                <i class="fas fa-bed mr-2 text-yellow-300"></i>Accommodation
                            </h4>
                            ${generateHotelCard(dayData.hotel)}
                        </div>
                        ` : ''}
                        
                        <!-- Cost Summary -->
                        <div class="bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-xl p-4 border border-purple-300/20">
                            <div class="flex justify-between items-center">
                                <div class="flex space-x-4 text-white/70 text-sm">
                                    <span>Activities: ${activityCost}</span>
                                    <span>Dining: ${restaurantCost}</span>
                                    ${dayData.hotel ? `<span>Hotel: ${hotelCost}</span>` : ''}
                                </div>
                                <div class="text-right">
                                    <span class="text-white/70">Total:</span>
                                    <span class="text-yellow-300 font-bold text-xl ml-2">${totalCost}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateActivityCard(timeOfDay, activity, icon) {
            if (!activity) return '<div class="text-white/50 p-4">No activity planned</div>';
            
            const mapLink = `https://maps.google.com/?q=${encodeURIComponent(activity.location || 'location')}`;
            
            return `
                <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all">
                    <div class="flex items-center mb-3">
                        <i class="${icon} text-yellow-300 mr-2"></i>
                        <h4 class="text-white font-semibold">${timeOfDay}</h4>
                    </div>
                    <p class="text-white mb-2 font-medium">${activity.activity || 'Activity'}</p>
                    <p class="text-white/70 text-sm mb-3">${activity.description || 'Great experience'}</p>
                    <p class="text-blue-200 text-sm mb-3">
                        <i class="fas fa-map-marker-alt mr-1"></i>${activity.location || 'Location'}
                    </p>
                    <div class="flex justify-between items-center">
                        <a href="${mapLink}" target="_blank" class="text-blue-300 hover:text-blue-200 text-sm bg-blue-500/20 px-3 py-1 rounded-lg transition-all">
                            <i class="fas fa-map-marker-alt mr-1"></i>Map
                        </a>
                        <span class="text-green-300 font-semibold">${activity.cost || 0}</span>
                    </div>
                </div>
            `;
        }

        function generateRestaurantCard(mealTime, restaurant) {
            if (!restaurant) {
                restaurant = {
                    name: `Local ${mealTime} Spot`,
                    cuisine: 'Local',
                    cost: mealTime === 'Lunch' ? 25 : 45,
                    location: 'City center',
                    description: `Great ${mealTime.toLowerCase()} option`
                };
            }
            
            const icon = mealTime === 'Lunch' ? 'fas fa-sun' : 'fas fa-moon';
            const mapLink = `https://maps.google.com/?q=${encodeURIComponent(restaurant.location || 'restaurant')}`;
            
            return `
                <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all">
                    <div class="flex items-center mb-3">
                        <i class="${icon} text-yellow-300 mr-2"></i>
                        <h5 class="text-white font-semibold">${mealTime}</h5>
                        <span class="ml-auto bg-purple-500/30 text-purple-200 px-2 py-1 rounded-full text-xs">${restaurant.cuisine || 'Local'}</span>
                    </div>
                    <p class="text-white font-medium mb-2">${restaurant.name || 'Restaurant'}</p>
                    <p class="text-white/70 text-sm mb-3">${restaurant.description || 'Great dining experience'}</p>
                    <p class="text-blue-200 text-sm mb-3">
                        <i class="fas fa-map-marker-alt mr-1"></i>${restaurant.location || 'Location'}
                    </p>
                    <div class="flex justify-between items-center">
                        <a href="${mapLink}" target="_blank" class="text-blue-300 hover:text-blue-200 text-sm bg-blue-500/20 px-3 py-1 rounded-lg transition-all">
                            <i class="fas fa-map-marker-alt mr-1"></i>Map
                        </a>
                        <span class="text-green-300 font-semibold">${restaurant.cost || 25}</span>
                    </div>
                </div>
            `;
        }

        function generateHotelCard(hotel) {
            if (!hotel) return '<div class="text-white/50">No hotel needed</div>';
            
            const mapLink = `https://maps.google.com/?q=${encodeURIComponent(hotel.location || 'hotel')}`;
            
            return `
                <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all max-w-md">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-bed text-yellow-300 mr-2"></i>
                        <h5 class="text-white font-semibold">Tonight's Stay</h5>
                        <div class="ml-auto flex items-center bg-green-500/30 text-green-200 px-2 py-1 rounded-full text-xs">
                            <i class="fas fa-star mr-1"></i>${hotel.rating || '4.0'}
                        </div>
                    </div>
                    <p class="text-white font-medium mb-2">${hotel.name || 'Hotel'}</p>
                    <p class="text-white/70 text-sm mb-3">${hotel.description || 'Comfortable accommodation'}</p>
                    <p class="text-blue-200 text-sm mb-3">
                        <i class="fas fa-map-marker-alt mr-1"></i>${hotel.location || 'Location'}
                    </p>
                    
                    ${hotel.amenities ? `
                    <div class="flex flex-wrap gap-1 mb-3">
                        ${hotel.amenities.map(amenity => 
                            `<span class="bg-white/10 text-white/80 px-2 py-1 rounded text-xs">${amenity}</span>`
                        ).join('')}
                    </div>
                    ` : ''}
                    
                    <div class="flex justify-between items-center">
                        <a href="${mapLink}" target="_blank" class="text-blue-300 hover:text-blue-200 text-sm bg-blue-500/20 px-3 py-1 rounded-lg transition-all">
                            <i class="fas fa-map-marker-alt mr-1"></i>Map
                        </a>
                        <span class="text-green-300 font-semibold">${hotel.cost || 120}/night</span>
                    </div>
                </div>
            `;
        }

        function generateTravelTips(tipsData) {
            const tipsContainer = document.getElementById('travelTips');
            
            tipsContainer.innerHTML = tipsData.map(tip => `
                <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all shadow-lg">
                    <div class="flex items-start">
                        <div class="bg-yellow-300/20 rounded-lg p-2 mr-3 flex-shrink-0">
                            <i class="fas fa-lightbulb text-yellow-300"></i>
                        </div>
                        <p class="text-white">${tip}</p>
                    </div>
                </div>
            `).join('');
        }
        
        // Event Handlers
        function setupEventHandlers() {
            // Handle preference selection
            document.querySelectorAll('.preference-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const preference = this.dataset.preference;
                    
                    if (selectedPreferences.includes(preference)) {
                        selectedPreferences = selectedPreferences.filter(p => p !== preference);
                        this.classList.remove('preference-selected');
                    } else {
                        selectedPreferences.push(preference);
                        this.classList.add('preference-selected');
                    }
                });
            });

            // Form submission
            document.getElementById('tripForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const destination = document.getElementById('destination').value.trim();
                const days = parseInt(document.getElementById('days').value);
                const budget = parseFloat(document.getElementById('budget').value);
                const travelers = parseInt(document.getElementById('travelers').value);
                
                if (!destination || !days || !budget || !travelers) {
                    alert('Please fill in all required fields!');
                    return;
                }
                
                // Show loading
                document.getElementById('loadingSection').classList.remove('hidden');
                document.getElementById('resultsSection').classList.add('hidden');
                startLoadingAnimation();
                
                try {
                    // Generate all AI content
                    const [budgetData, itineraryData, tipsData] = await Promise.all([
                        generateAIBudget(destination, budget, days, travelers),
                        generateAIItinerary(destination, days, budget, travelers, selectedPreferences),
                        generateAITips(destination, selectedPreferences)
                    ]);
                    
                    // Small delay for effect
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Generate UI
                    generateBudgetBreakdown(budgetData);
                    generateDailyItinerary(itineraryData);
                    generateTravelTips(tipsData);
                    
                    // Show results
                    stopLoadingAnimation();
                    setTimeout(() => {
                        document.getElementById('loadingSection').classList.add('hidden');
                        document.getElementById('resultsSection').classList.remove('hidden');
                        document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                    }, 1000);
                    
                } catch (error) {
                    console.error('Generation Error:', error);
                    stopLoadingAnimation();
                    document.getElementById('loadingSection').classList.add('hidden');
                    alert('Error generating itinerary. Please try again.');
                }
            });

            // Share functionality
            document.addEventListener('click', function(e) {
                if (e.target.id === 'shareBtn' || e.target.closest('#shareBtn')) {
                    const destination = document.getElementById('destination').value;
                    const days = document.getElementById('days').value;
                    const text = `Check out my ${days}-day trip to ${destination} planned with TripGenie AI!`;
                    
                    if (navigator.share) {
                        navigator.share({ title: 'My TripGenie Itinerary', text, url: window.location.href });
                    } else {
                        navigator.clipboard.writeText(`${text}\n${window.location.href}`);
                        alert('Link copied to clipboard!');
                    }
                }
            });

            // PDF Download
            document.addEventListener('click', function(e) {
                if (e.target.id === 'downloadBtn' || e.target.closest('#downloadBtn')) {
                    if (!currentItineraryData) {
                        alert('Please generate an itinerary first!');
                        return;
                    }
                    
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    doc.setFontSize(20);
                    doc.text('TripGenie Itinerary', 20, 20);
                    
                    const destination = document.getElementById('destination').value;
                    const days = document.getElementById('days').value;
                    const budget = document.getElementById('budget').value;
                    
                    doc.setFontSize(12);
                    doc.text(`Destination: ${destination}`, 20, 40);
                    doc.text(`Duration: ${days} days`, 20, 50);
                    doc.text(`Budget: ${budget}`, 20, 60);
                    
                    let yPos = 80;
                    currentItineraryData.itinerary.forEach(day => {
                        if (yPos > 250) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        doc.setFontSize(14);
                        doc.text(`Day ${day.day}`, 20, yPos);
                        yPos += 15;
                        
                        doc.setFontSize(10);
                        if (day.morning) {
                            doc.text(`Morning: ${day.morning.activity} (${day.morning.cost})`, 25, yPos);
                            yPos += 10;
                        }
                        if (day.afternoon) {
                            doc.text(`Afternoon: ${day.afternoon.activity} (${day.afternoon.cost})`, 25, yPos);
                            yPos += 10;
                        }
                        if (day.evening) {
                            doc.text(`Evening: ${day.evening.activity} (${day.evening.cost})`, 25, yPos);
                            yPos += 15;
                        }
                    });
                    
                    doc.save(`tripgenie-${destination.toLowerCase()}-itinerary.pdf`);
                }
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', setupEventHandlers);
    </script>
</body>
</html>